<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="jquery/dist/jquery.js"></script>

    <script src="/socket.io/socket.io.js"></script>

    <style>
        #total,
        #register {
            font-size: 32px;
        }
    </style>

    <script src="../javascripts/library.js"></script>

    <script src="../javascripts/shape.js"></script>

    <script>
        var depthLineGraph;

        var volumeLineGraph;

        function drawLine(depth, volume) {
            try {
                var canvasDepthGraph = document.getElementById("canvasDepthGraph");

                if (canvasDepthGraph.getContext) {
                    var contextDepth = canvasDepthGraph.getContext("2d");

                    var depthHeight = depth * 200 / 200;

                    //$("#value").text("{0} / {1} / {2}/ {3}".format(canvas.style.left, canvas.style.top, canvas.width, canvas.height));

                    if (depthLineGraph == null) {
                        depthLineGraph = new LineGraph(0, 0, canvasDepthGraph.width, canvasDepthGraph.height, 'red');

                        depthLineGraph.setLineWidth(1);
                    }

                    depthLineGraph.add(depthHeight);

                    depthLineGraph.draw(contextDepth);

                } else {
                    alert("Canvas is not supported.");
                }

                var canvasVolumeGraph = document.getElementById("canvasVolumeGraph");

                if (canvasVolumeGraph.getContext) {
                    var contextVolume = canvasVolumeGraph.getContext("2d");

                    var volumeHeight = volume * 200 / 200;

                    if (volumeLineGraph == null) {
                        volumeLineGraph = new LineGraph(0, 0, canvasVolumeGraph.width, canvasVolumeGraph.height, 'blue');

                        volumeLineGraph.setLineWidth(1);
                    }

                    //volumeLineGraph.add(volumeHeight);

                    //volumeLineGraph.draw(contextVolume);
                } else {
                    alert("Canvas is not supported.");
                }
            } catch (e) {
                alert(e);
            }
        }

        function drawBar(value) {
            try {

                var canvas = document.getElementById("canvasBarGraph");

                if (canvas.getContext) {
                    var context = canvas.getContext("2d");

                    var height = value * 200 / 136;

                    var context = canvas.getContext("2d", { alpha: false });

                    var barGraph = new BarGraph(0, 0, 100, 500, 'green');

                    barGraph.draw(context, height);
                } else {
                    alert("Canvas is not supported.");
                }
            } catch (e) {
                alert(e);
            }
        }
    </script>

    <script>
        var count = 0;

        $(document).ready(function () {
            var socket = io.connect();

            socket.on('update', function (data) {
                try {
                    $("#value").text(format("Data : %%", data));

                    //if (!isNaN(data)) {

                    //} else {
                    //    $("#value").text(data);
                    //}

                    if (data) {

                        var depth = parseInt(data.depth);

                        var volume = parseInt(data.volume);

                        $("#value").text("depth : {0} volume : {1}".format(depth, volume));

                        drawBar(volume);

                        drawLine(depth, volume);
                    } else {
                        $("#value").text(data);
                    }

                    $("#info").text("Count : {0}".format(count++));

                } catch (e) {
                    $("#value").text("Error : " + e);
                }
            });

            $('#btnOn').click(function () {
                socket.emit('On', "ON");
            });

            $('#btnOff').click(function () {
                socket.emit('Off', "OFF");
            });
        });

    </script>
</head>

<body>
    <div>
        <p id="value" style="display:block">Value</p>
        <p id="info" style="display:block">Infomation</p>

        <button id="btnOn" style="margin:0px;">ON</button>
        <button id="btnOff" style="margin:0px;">OFF</button>

        <hr />

        <canvas id="canvasBarGraph" width="600" height="200"
            style="background-color:hotpink; border: 0px solid blue; position:relative; margin:0px; left:10px; top:10px;"></canvas>

        <hr />

        <canvas id="canvasDepthGraph" width="600" height="200"
            style="display:inline; background-color:greenyellow;  position:relative; margin:0px; border: 0px solid blue; left:10px; top:10px;"></canvas>

        <hr />

        <canvas id="canvasVolumeGraph" width="600" height="200"
            style="display:inline; background-color:yellowgreen;  position:relative; margin:0px; border: 0px solid blue; left:10px; top:10px;"></canvas>
    </div>
</body>

</html>